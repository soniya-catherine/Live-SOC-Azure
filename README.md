# Setting Up a Honeynet and SOC in Azure: Analyzing Live Network Traffic
![topology](https://github.com/user-attachments/assets/523a58d7-c186-4950-bad9-b30bd0e40847)



## Introduction

This project focuses on creating a mini honeynet within the Azure environment, utilizing a variety of log sources that feed into a centralized Log Analytics workspace. By employing Microsoft Sentinel, I am able to visualize attack patterns, set off alerts, and document incidents.

The project unfolds in two phases:

1.	Initial Monitoring: I observed security metrics in an unprotected setting for 24 hours.
2.	Enhancement and Reassessment: After implementing several security controls to strengthen the environment, I monitored the same metrics for another 24 hours.

The key metrics examined throughout this process include:

- SecurityEvent : Captured from Windows Event Logs
- Syslog : Derived Linux Event Logs
- SecurityAlert : Alerts generated by Log Analytics
- SecurityIncident : Incidents logged by Microsoft Sentinel
- AzureNetworkAnalytics_CL : Instances of malicious traffic that gained entry into the honeynet

## Architecture Before Hardening / Security Controls
![architecture-before](https://github.com/user-attachments/assets/b0512484-3ea6-46de-9aa3-0e31acc5a07e)


## Architecture After Hardening / Security Controls
![architecture-after-diagram](https://github.com/user-attachments/assets/a8682970-a8ab-40ee-beaf-ff97f8d62b72)


The mini honeynet architecture in Azure comprises several key components:

- Virtual Network (VNet)
- Network Security Group (NSG)
- Virtual Machines (2 windows, 1 linux)
- Log Analytics Workspace
- Azure Key Vault
- Azure Storage Account
- Microsoft Sentinel

Initial Configuration (“BEFORE” Metrics)

Initially, all resources were deployed with public access, making them visible to the internet. The Virtual Machines were configured with their Network Security Groups and built-in firewalls fully open, while the remaining resources also had public endpoints exposed. In this state, there were no Private Endpoints utilized, which left the environment vulnerable to external threats.

Enhanced Configuration (“AFTER” Metrics)

After implementing security measures, the Network Security Groups were fortified to block all traffic except for that from my admin workstation. Additionally, each resource was safeguarded by its own built-in firewall, and Private Endpoints were employed to further protect sensitive data and services.

This strategic architecture shift significantly improved the security posture of the mini honeynet.


## Attack Maps Before Hardening / Security Controls
![before-mssql-auth-fail](https://github.com/user-attachments/assets/d2bb42d7-21e2-43b1-9760-533e5c84ab26)<br><br>
<img width="1272" alt="before-nsg-malicious-allowed-in" src="https://github.com/user-attachments/assets/c38c2c07-fd65-4866-81e6-85d4060445f0"><br><br>
<img width="1184" alt="before-linux-ssh-auth-fail" src="https://github.com/user-attachments/assets/1878990f-9323-4ec8-b187-8aa586d6cf6d"><br><br>
<img width="1272" alt="before-windows-rdp-auth-fail" src="https://github.com/user-attachments/assets/e6b794ab-bed2-40b5-9fd8-865b0ff3441e"><br>



## Metrics Before Hardening / Security Controls

The following table shows the metrics we measured in our insecure environment for 24 hours:
Start Time 2024-09-29 07:52:21
Stop Time 2024-09-30 07:52:21

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 114465
| Syslog                   | 10814
| SecurityAlert            | 4
| SecurityIncident         | 205
| AzureNetworkAnalytics_CL | 3513

## Attack Maps Before Hardening / Security Controls

```All map queries actually returned no results due to no instances of malicious activity for the 24 hour period after hardening.```

## Metrics After Hardening / Security Controls

The following table shows the metrics we measured in our environment for another 24 hours, but after we have applied security controls:
Start Time 2024-10-03 06:01:56
Stop Time	2024-10-04 06:01:56

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 19878
| Syslog                   | 10
| SecurityAlert            | 0
| SecurityIncident         | 0
| AzureNetworkAnalytics_CL | 0

## Conclusion

This project involved the creation of a mini honeynet in Microsoft Azure, where various log sources were integrated into a Log Analytics workspace. By leveraging Microsoft Sentinel, I was able to trigger alerts and generate incidents based on the collected logs.

The evaluation process consisted of two phases: metrics were collected in an unprotected environment prior to applying any security controls, followed by another round of measurements after implementing these measures. The results were significant; there was a noticeable decrease in both the number of security events and incidents after the controls were applied, highlighting their effectiveness.

Additionally, it’s important to consider that if the network resources had been actively used by regular users during this time, it’s possible that a higher volume of security events and alerts would have been recorded in the 24 hours post-implementation of the security controls. This suggests that user activity can heavily influence security metrics and alerts.
